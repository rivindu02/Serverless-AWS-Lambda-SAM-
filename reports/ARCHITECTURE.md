# ğŸ—ï¸ School Management System - AWS Architecture

A **Lambda-to-ECS-to-EFS architecture** providing a scalable, serverless Express.js API with MongoDB persistent storage.

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AWS Cloud (us-east-2)                               â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          VPC: 10.0.0.0/16                                â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  PUBLIC TIER (10.0.1.0/24)                                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Internet   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   NAT Gateway    â”‚                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Gateway    â”‚              â”‚   (Elastic IP)   â”‚                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                            â”‚                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  APPLICATION TIER (Lambda)              â”‚                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Subnet 1: 10.0.2.0/24 (AZ-A)           â”‚                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Subnet 2: 10.0.3.0/24 (AZ-B)           â”‚                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                         â”‚                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ API Gateway  â”‚â”€â”€â”€â–ºâ”‚       Lambda Function (Docker)            â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  HTTP API    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  /{proxy+}   â”‚    â”‚  â”‚   Lambda Web Adapter (Port 3000)    â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚         â”‚   Express.js API  â”‚       â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚         â”‚   + JWT Auth      â”‚       â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚         â”‚   + Zod Validationâ”‚       â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                             â”‚ mongodb://mongo.local:27017â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  DATA TIER (ECS Fargate)                 â”‚                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Subnet 1: 10.0.4.0/24 (AZ-A)            â”‚                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Subnet 2: 10.0.5.0/24 (AZ-B)            â–¼                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  MongoDB Container (ECS Fargate)                              â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Image: mongo:latest                                        â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Port: 27017                                                â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Service Discovery: mongo.local                             â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ No Public IP                                               â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                               â”‚ NFS (Port 2049)                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Amazon EFS (Persistent Storage)                              â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Mount: /data/db | Encrypted at rest | Multi-AZ             â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Network Configuration

### Subnet Layout

| Tier | Subnet | CIDR | AZ | Purpose |
|------|--------|------|-----|---------|
| **Public** | public | 10.0.1.0/24 | us-east-2a | NAT Gateway, Internet Gateway |
| **Application** | lambda_private_1 | 10.0.2.0/24 | us-east-2a | Lambda functions |
| **Application** | lambda_private_2 | 10.0.3.0/24 | us-east-2b | Lambda functions (HA) |
| **Data** | ecs_private_1 | 10.0.4.0/24 | us-east-2a | MongoDB ECS, EFS |
| **Data** | ecs_private_2 | 10.0.5.0/24 | us-east-2b | MongoDB ECS, EFS (HA) |

### Route Tables

| Route Table | Destination | Target | Subnets |
|-------------|-------------|--------|---------|
| Public | 0.0.0.0/0 | Internet Gateway | public |
| Private | 0.0.0.0/0 | NAT Gateway | All private subnets |

---

## Security Groups

### Security Flow
```
Lambda (RVK-mongo-db-sg) â”€â”€27017â”€â”€â–º MongoDB (RVK-ecs-mongo-sg) â”€â”€2049â”€â”€â–º EFS (mongo-efs-sg)
```

### Rules Matrix

| Security Group | Tier | Inbound | Outbound |
|----------------|------|---------|----------|
| **RVK-mongo-db-sg** | Application | None | 27017â†’MongoDB SG, 443/80â†’Internet |
| **RVK-ecs-mongo-sg** | Data | 27017â†Lambda SG | 2049â†’EFS SG, 443/80/53â†’Internet |
| **mongo-efs-sg** | Storage | 2049â†MongoDB SG | None |

---

## Components

### Lambda Function (Application Layer)

| Property | Value |
|----------|-------|
| Runtime | Docker (node:20-alpine) |
| Framework | Express.js 5 |
| Adapter | Lambda Web Adapter v0.9.1 |
| Port | 3000 |
| Memory | 512 MB |
| Timeout | 30 seconds |

### ECS Fargate (Database Layer)

| Property | Value |
|----------|-------|
| Image | mongo:latest |
| CPU | 256 units (0.25 vCPU) |
| Memory | 512 MB |
| Port | 27017 |
| Service Discovery | mongo.local |
| Public IP | Disabled |

### EFS (Storage Layer)

| Property | Value |
|----------|-------|
| Mount Path | /data/db |
| Encryption | At rest enabled |
| Mount Targets | Both data tier subnets |

---

## Request Flow

```
Client â†’ API Gateway â†’ Lambda â†’ MongoDB (ECS) â†’ EFS
           â”‚              â”‚           â”‚           â”‚
         HTTPS      JWT Auth    Service       NFS
                    Zod Valid   Discovery    Mount
```

---

## Deployment

### 1. Infrastructure (Terraform)
```bash
cd Terraform
terraform init && terraform apply
```

### 2. Application (SAM)
```bash
sam build && sam deploy
```

### SSM Parameters (Terraform â†’ SAM)

| Parameter | Description |
|-----------|-------------|
| `/school-mgmt/vpc/id` | VPC ID |
| `/school-mgmt/vpc/lambda-private-subnets` | Lambda subnet IDs |
| `/school-mgmt/lambda-sg-id` | Lambda security group ID |
| `/school-mgmt/db/mongo-sg-id` | MongoDB security group ID |

---

## Cost Estimate (Low Traffic)

| Service | Monthly Cost |
|---------|--------------|
| NAT Gateway | ~$32 |
| ECS Fargate | ~$20 |
| EFS | ~$5 |
| Lambda | Free tier |
| API Gateway | ~$1 |
| **Total** | **~$60/month** |

---

## Security Checklist

- âœ… All compute in private subnets
- âœ… No public IPs on Lambda/MongoDB
- âœ… Security group references (not CIDR)
- âœ… EFS encryption at rest
- âœ… JWT authentication
- âœ… Zod input validation
- âœ… bcrypt password hashing
- âœ… NAT Gateway for outbound only

---

## Quick Reference

| Item | Value |
|------|-------|
| Region | us-east-2 |
| VPC CIDR | 10.0.0.0/16 |
| MongoDB DNS | mongo.local:27017 |
| API Path | /{proxy+} |
| Lambda Memory | 512 MB |
| Lambda Timeout | 30s |
